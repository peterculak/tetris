(()=>{"use strict";var t;!function(t){t.T="T",t.O="O",t.L="L",t.J="J",t.I="I",t.S="S",t.Z="Z"}(t||(t={}));var e={T:[[0,0,0],[1,1,1],[0,1,0]],O:[[2,2],[2,2]],L:[[0,3,0],[0,3,0],[0,3,3]],J:[[0,4,0],[0,4,0],[4,4,0]],I:[[0,5,0,0],[0,5,0,0],[0,5,0,0],[0,5,0,0]],S:[[0,6,6],[6,6,0],[0,0,0]],Z:[[7,7,0],[0,7,7],[0,0,0]]};function r(r){if(!Object.values(t).includes(r))throw new Error("Invalid type '".concat(r,"'"));return e[r]}function o(){var e=Object.values(t);return r(t[e[Math.floor(e.length*Math.random())]])}var a=function(){return a=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},a.apply(this,arguments)},i=function(t,e,r){if(r||2===arguments.length)for(var o,a=0,i=e.length;a<i;a++)!o&&a in e||(o||(o=Array.prototype.slice.call(e,0,a)),o[a]=e[a]);return t.concat(o||Array.prototype.slice.call(e))};const n=function(){function t(){this.arena=this.createArena(12,20),this.player={pos:{x:0,y:0},matrix:o(),score:0},this.playerReset()}return t.prototype.moveRight=function(){this.playerMove(1)},t.prototype.moveLeft=function(){this.playerMove(-1)},t.prototype.moveDown=function(){this.playerDrop()},t.prototype.rotate=function(){this.playerRotate(1)},Object.defineProperty(t.prototype,"state",{get:function(){return{player:a({},this.player),arena:i([],this.arena,!0)}},enumerable:!1,configurable:!0}),t.prototype.createArena=function(t,e){for(var r=[];e--;)r.push(new Array(t).fill(0));return r},t.prototype.collide=function(t,e){for(var r=[e.matrix,e.pos],o=r[0],a=r[1],i=0;i<o.length;++i)for(var n=0;n<o[i].length;++n)if(0!==o[i][n]&&0!==(t[a.y+i]&&t[a.y+i][a.x+n]))return!0;return!1},t.prototype.merge=function(t,e){e.matrix.forEach((function(r,o){r.forEach((function(r,a){0!==r&&(t[o+e.pos.y][a+e.pos.x]=r)}))}))},t.prototype._rotate=function(t){for(var e,r=0;r<this.player.matrix.length;++r)for(var o=0;o<r;++o)e=[this.player.matrix[r][o],this.player.matrix[o][r]],this.player.matrix[o][r]=e[0],this.player.matrix[r][o]=e[1];t>0?this.player.matrix.forEach((function(t){return t.reverse()})):this.player.matrix.reverse()},t.prototype.playerReset=function(){this.player.matrix=o(),this.player.pos.y=0,this.player.pos.x=Math.floor(this.arena[0].length/2)-Math.floor(this.player.matrix.length/2)},t.prototype.gameOver=function(){this.playerReset(),this.player.score=0,this.arena.forEach((function(t,e){return t.fill(0)}))},t.prototype.playerRotate=function(t){var e=this.player.pos.x,r=1;for(this._rotate(t);this.collide(this.arena,this.player);)if(this.player.pos.x+=r,(r=(r>0?1:-1)-r)>this.player.matrix[0].length)return this._rotate(-t),void(this.player.pos.x=e)},t.prototype.playerDrop=function(){this.player.pos.y++,this.collide(this.arena,this.player)&&(this.player.pos.y--,this.merge(this.arena,this.player),this.playerReset(),this.arenaSweep(),this.collide(this.arena,this.player)&&this.gameOver())},t.prototype.arenaSweep=function(){var t=1;t:for(var e=this.arena.length-1;e>0;--e){for(var r=0;r<this.arena[e].length;++r)if(0===this.arena[e][r])continue t;var o=this.arena.splice(e,1)[0].fill(0);this.arena.unshift(o),e++,this.player.score+=10*t,t*=2}},t.prototype.playerMove=function(t){this.player.pos.x+=t,this.collide(this.arena,this.player)&&(this.player.pos.x-=t)},t}();var s,h,p=function(){return p=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},p.apply(this,arguments)};!function(t){t[t.null=0]="null",t[t["#e27d60"]=1]="#e27d60",t[t["#85dcb0"]=2]="#85dcb0",t[t["#e8a87c"]=3]="#e8a87c",t[t["#c38d9e"]=4]="#c38d9e",t[t["#41b3a3"]=5]="#41b3a3",t[t["#f64c72"]=6]="#f64c72",t[t["#fbeec1"]=7]="#fbeec1"}(s||(s={})),function(t){t.left="left",t.right="right",t.down="down",t.rotate="rotate"}(h||(h={})),new(function(){function t(t,e,r){var o=this;this._scoreId=e,this.options=r,this.lastTime=0,this.dropCounter=0,this.defaults={controls:{left:"ArrowLeft",right:"ArrowRight",down:"ArrowDown",rotate:"ArrowUp"},dropInterval:1e3},this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d"),this.context.scale(20,20),this.game=new n,this.options=p(p({},this.defaults),r),document.addEventListener("keydown",(function(t){t.code===o.options.controls.right?o.game.moveRight():t.code===o.options.controls.left?o.game.moveLeft():t.code===o.options.controls.down?o.game.moveDown():t.code===o.options.controls.rotate&&o.game.rotate()}))}return t.prototype.start=function(t){void 0===t&&(t=0);var e=t-this.lastTime;this.lastTime=t,this.dropCounter+=e,this.dropCounter>this.options.dropInterval&&(this.game.moveDown(),this.dropCounter=0),this.drawGame(),requestAnimationFrame(this.start.bind(this))},t.prototype.drawGame=function(){this.context.fillStyle="#000",this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawArena(this.game.state.arena,{x:0,y:0}),this.drawArena(this.game.state.player.matrix,this.game.state.player.pos),document.getElementById(this._scoreId).innerHTML=this.game.state.player.score+""},t.prototype.drawArena=function(t,e){var r=this;t.forEach((function(t,o){t.forEach((function(t,a){0!==t&&(r.context.fillStyle=s[t],r.context.fillRect(a+e.x,o+e.y,1,1))}))}))},t}())("tetris","score").start()})();